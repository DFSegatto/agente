async function buscar() {

  const cidadeValor = document.getElementById("cidade").value.trim();
  const lista = document.getElementById("lista");

  if (!cidadeValor){
    alert("Digite a cidade");
    return;
  }

  lista.textContent = "Localizando cidade...";

  // Geocodificar cidade
  const geoResp = await fetch(
    `https://nominatim.openstreetmap.org/search?city=${cidadeValor}&country=Brazil&format=json`
  );

  const geoData = await geoResp.json();

  if (geoData.length === 0){
    lista.textContent = "Cidade n√£o encontrada.";
    return;
  }

  const { lat, lon, boundingbox } = geoData[0];

  const south = boundingbox[0];
  const north = boundingbox[1];
  const west = boundingbox[2];
  const east = boundingbox[3];

  lista.textContent = "Ca√ßando clientes EXTREMOS...";

  const query = `
  [out:json][timeout:25];
  (
    node["shop"](${south},${west},${north},${east});
    node["amenity"~"restaurant|cafe|fast_food|pharmacy|clinic|bar|pub"](${south},${west},${north},${east});
    node["office"](${south},${west},${north},${east});
    node["tourism"="hotel"](${south},${west},${north},${east});
  );
  out tags center 80;
  `;

  try {

    const response = await fetch(
      "https://overpass-api.de/api/interpreter",
      { method:"POST", body:query }
    );

    const data = await response.json();

    // üî• FILTRO EXTREMO
    const empresas = data.elements
      .filter(e => {
        if (!e.tags || !e.tags.name) return false;

        const t = e.tags;

        const semSite = !t.website && !t["contact:website"];
        const temTelefone = t.phone || t["contact:phone"];
        const temRede = t["contact:instagram"] || t["contact:facebook"];

        return semSite && temTelefone && temRede;
      })
      .slice(0,20);

    mapa.setView([lat, lon], 13);

    mapa.eachLayer(l => {
      if (l instanceof L.Marker) mapa.removeLayer(l);
    });

    if (empresas.length === 0){
      lista.textContent = "Nenhum cliente extremo encontrado.";
      return;
    }

    empresasGlobal = empresas;

    lista.textContent = empresas.map((e,i)=>{

      const t = e.tags;

      const tipo = t.shop || t.amenity || t.office || t.tourism || "empresa";

      const telefone =
        t.phone ||
        t["contact:phone"] ||
        "N√£o informado";

      const redes =
        t["contact:instagram"] ||
        t["contact:facebook"] ||
        "Sem redes";

      const endereco =
        (t["addr:street"] || "") + " " + (t["addr:housenumber"] || "");

      const latE = e.lat || e.center?.lat;
      const lonE = e.lon || e.center?.lon;

      if (latE && lonE){
        L.marker([latE, lonE])
          .addTo(mapa)
          .bindPopup(`
            <b>${t.name}</b><br>
            ${tipo}<br>
            üìû ${telefone}<br>
            üìç ${endereco}<br>
            ‚ùå SEM SITE
          `);
      }

      return `
üî• CLIENTE QUENTE ${i+1}
${t.name}
Tipo: ${tipo}
Telefone: ${telefone}
Endere√ßo: ${endereco}
Redes: ${redes}
‚ùå N√ÉO POSSUI SITE
`;

    }).join("\n======================");

  } catch (erro){
    lista.textContent = "Erro na busca.";
    console.error(erro);
  }
}
